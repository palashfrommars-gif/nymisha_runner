<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nymisha Runner</title>
<style>
  body {
    margin: 0;
    background: linear-gradient(#aee1f9, #ffffff);
    overflow: hidden;
    font-family: sans-serif;
  }
  canvas { display: block; margin: 0 auto; background: #cce7ff; }
  #score { position: absolute; top: 10px; left: 10px; font-size: 20px; background: rgba(255,255,255,0.8); padding: 5px 10px; border-radius: 8px; }
  #message { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 32px; background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px; display: none; }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<div id="message"></div>
<canvas id="game" width="800" height="400"></canvas>
<audio id="happySound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const messageEl = document.getElementById('message');
const happySound = document.getElementById('happySound');

let obstacles = [
  "Kiwi issues", "Life issues", "Body pain", "Seema aunty", "Crying"
];
let speed = 3.3; // 10% faster than old 3.0
let gravity = 0.6;
let jumpPower = -10;

let nymisha = { x: 50, y: 300, vy: 0, jumping: false };
let arjun = { x: 700, y: 300, vy: 0, jumping: false };

let score = 0;
let obstacleObjects = [];
let celebrationStarted = false;
let celebrationStartTime = 0;
const CELEB_MS = 5000;

function glossyBall(x, y, radius, label, faceBlink) {
  let grad = ctx.createRadialGradient(x - radius/3, y - radius/3, radius/5, x, y, radius);
  grad.addColorStop(0, "#d8b3ff");
  grad.addColorStop(1, "#7a3db8");
  ctx.fillStyle = grad;
  ctx.beginPath();
  ctx.arc(x, y, radius, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle = "#000";
  let eyeOffsetY = faceBlink ? y+2 : y;
  ctx.beginPath(); ctx.arc(x - radius/3, eyeOffsetY - radius/4, 4, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(x + radius/3, eyeOffsetY - radius/4, 4, 0, Math.PI*2); ctx.fill();

  ctx.strokeStyle = "#000";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.arc(x, y+2, radius/2.5, 0, Math.PI);
  ctx.stroke();

  ctx.fillStyle = "#fff";
  ctx.font = "bold 14px sans-serif";
  ctx.textAlign = "center";
  ctx.fillText(label, x, y + radius + 15);
}

function spawnObstacle() {
  if(obstacles.length > 0){
    let name = obstacles.shift();
    obstacleObjects.push({ x: canvas.width, y: 300, name });
  }
}

function jump(player) {
  if(!player.jumping) {
    player.vy = jumpPower;
    player.jumping = true;
  }
}

document.addEventListener('keydown', e => {
  if(e.code === 'Space') jump(nymisha);
});
canvas.addEventListener('click', () => jump(nymisha));

let lastTime = 0;
function loop(ts) {
  let dt = (ts - lastTime) / 16.67;
  lastTime = ts;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "#7ac27a";
  ctx.fillRect(0, 350, canvas.width, 50);

  if(!celebrationStarted) {
    obstacleObjects.forEach(o => o.x -= speed*dt);

    if(obstacleObjects.length === 0 && obstacles.length > 0) spawnObstacle();

    obstacleObjects = obstacleObjects.filter(o => {
      if(o.x < -100) return false;
      if(Math.abs(o.x - nymisha.x) < 40 && nymisha.y > 280) {
        score -= 5;
        return false;
      }
      return true;
    });

    nymisha.y += nymisha.vy;
    nymisha.vy += gravity;
    if(nymisha.y >= 300) { nymisha.y = 300; nymisha.vy = 0; nymisha.jumping = false; }

    if(obstacles.length === 0 && obstacleObjects.length === 0) {
      celebrationStarted = true;
      celebrationStartTime = performance.now();
      nymisha.vy = -5;
      arjun.vy = -5;
      nymisha.jumping = true;
      arjun.jumping = true;
      happySound.play();
    }
  } else {
    let elapsed = performance.now() - celebrationStartTime;
    nymisha.y += nymisha.vy;
    nymisha.vy += gravity;
    if(nymisha.y >= 300) { nymisha.y = 300; if(elapsed < CELEB_MS) nymisha.vy = -5; }

    arjun.y += arjun.vy;
    arjun.vy += gravity;
    if(arjun.y >= 300) { arjun.y = 300; if(elapsed < CELEB_MS) arjun.vy = -5; }

    if(elapsed >= CELEB_MS) {
      messageEl.textContent = "ðŸŽ‰ You Won! ðŸŽ‰";
      messageEl.style.display = "block";
      return;
    }
  }

  glossyBall(nymisha.x, nymisha.y, 25, "Nymisha", Math.floor(ts/400)%2===0);
  glossyBall(arjun.x, arjun.y, 25, "Arjun", Math.floor(ts/500)%2===0);

  obstacleObjects.forEach(o => {
    ctx.fillStyle = "#ffcc00";
    ctx.fillRect(o.x, o.y, 40, 40);
    ctx.fillStyle = "#000";
    ctx.font = "10px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText(o.name, o.x + 20, o.y + 55);
  });

  scoreEl.textContent = "Score: " + score;

  requestAnimationFrame(loop);
}

spawnObstacle();
requestAnimationFrame(loop);
</script>
</body>
</html>
