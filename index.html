<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Jumping Ball Runner â€” Nymisha (Mobile + PC)</title>
<style>
  :root{
    --bg1:#ffefef; --bg2:#eef9ff; --accent:#ff7f50; --muted:#6b7280; --panel: rgba(255,255,255,0.88);
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg2),var(--bg1));}
  .wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:16px;box-sizing:border-box;gap:10px}
  h1{margin:4px 0 0;font-size:18px;color:#333;text-align:center}
  .hud{display:flex;gap:10px;align-items:center;padding:8px 10px;background:var(--panel);border-radius:12px;box-shadow:0 10px 30px rgba(17,24,39,0.06);font-weight:700;backdrop-filter: blur(6px)}
  .hud div{font-size:14px;color:var(--muted)}
  #canvasWrap{width:min(980px,96vw);height:min(64vh,740px);border-radius:14px;overflow:hidden;margin-top:6px;box-shadow:0 18px 50px rgba(10,30,60,0.12);background:linear-gradient(180deg,#bfeaff,#fffaf2);position:relative}
  canvas{display:block;width:100%;height:100%}
  .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  button{border:0;padding:10px 14px;border-radius:10px;font-weight:800;cursor:pointer;background:var(--accent);color:white;box-shadow:0 8px 18px rgba(255,127,80,0.14)}
  button.secondary{background:#4b6ef6}
  #msg{margin-top:6px;color:#0b6;font-weight:800;min-height:20px;text-align:center;max-width:900px}
  @media (max-width:520px){
    h1{font-size:16px}
    .hud div{font-size:13px}
    button{padding:9px 12px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Jumping Ball Runner â€” Nymisha</h1>
    <div class="hud" id="hud">
      <div>Score: <span id="score">0</span></div>
      <div>High: <span id="high">0</span></div>
      <div>Speed: <span id="speed">1.0x</span></div>
      <div>Passed: <span id="passed">0</span>/5</div>
    </div>

    <div id="canvasWrap">
      <canvas id="canvas"></canvas>
    </div>

    <div class="controls">
      <button id="start">Start</button>
      <button id="retry" class="secondary" style="display:none">Retry</button>
      <button id="mute">ðŸ”Š Sound: On</button>
    </div>
    <div id="msg">Press Start â†’ Space / Click / Tap to jump. Clear the labeled obstacles: Kiwi issues, Life issues, Body pain, Seem aunty, Crying. Reach Arjun to win.</div>
  </div>

<script>
/* -----------------------
   Config
   ----------------------- */
const TOTAL_OBS = 5;
const OB_LABELS = ["Kiwi issues","Life issues","Body pain","Seem aunty","Crying"];
const OB_ICONS = { "Kiwi issues":"ðŸ¥", "Life issues":"ðŸŒªï¸", "Body pain":"ðŸ’¢", "Seem aunty":"ðŸ‘©â€ðŸ¦³", "Crying":"ðŸ˜­" };

const BASE_SPEED = 2.0;
const SPEED_ACCEL = 0.00045;
const GRAVITY = 0.6;
const JUMP_V = -13;
const HIGH_KEY = 'nymisha_aesthetic_high_v2';

/* -----------------------
   Canvas & DOM (DPR-aware)
   ----------------------- */
const wrap = document.getElementById('canvasWrap');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

const scoreEl = document.getElementById('score');
const highEl = document.getElementById('high');
const speedEl = document.getElementById('speed');
const passedEl = document.getElementById('passed');
const startBtn = document.getElementById('start');
const retryBtn = document.getElementById('retry');
const muteBtn = document.getElementById('mute');
const msgEl = document.getElementById('msg');

let CW = 960, CH = 600;
function fit() {
  const dpr = Math.max(1, Math.min(3, window.devicePixelRatio || 1));
  const w = Math.max(320, Math.floor(wrap.clientWidth));
  const h = Math.max(260, Math.floor(wrap.clientHeight));
  CW = w; CH = h;
  canvas.width = Math.floor(w * dpr);
  canvas.height = Math.floor(h * dpr);
  canvas.style.width = w + 'px';
  canvas.style.height = h + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0); // draw in CSS pixels
}
fit();
window.addEventListener('resize', fit, {passive:true});

/* -----------------------
   Audio
   ----------------------- */
let audioCtx = null;
let soundOn = true;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
function tone(freq, dur=0.08, type='sine', vol=0.12){
  if(!soundOn) return;
  ensureAudio();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type; o.frequency.value = freq;
  g.gain.value = vol;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
  o.stop(audioCtx.currentTime + dur + 0.03);
}
const sJump=()=>tone(520,0.06,'sine',0.12);
const sPass=()=>tone(880,0.05,'triangle',0.12);
const sHit =()=>tone(180,0.18,'sawtooth',0.2);
function sWin(){ tone(1100,0.14,'triangle',0.14); setTimeout(()=>tone(1400,0.08,'sine',0.12),120); }

/* -----------------------
   Game state
   ----------------------- */
let highScore = Number(localStorage.getItem(HIGH_KEY) || 0);
highEl.textContent = highScore;

let running=false, paused=true, celebrating=false, lastTS=0;
let world = { speed: BASE_SPEED, distance: 0, obstacles: [], passed: 0, score: 0 };
const player = { screenX: 160, y:0, vy:0, size:40, grounded:true };
let finishX = 0;
let arjun = { worldX:0, jumping:false, jt:0, bouncePhase:0 };
let plane = { x: 0, y: 80, speed: 0.4 };

/* -----------------------
   Build track (fixed 5 obstacles)
   ----------------------- */
function buildTrack(){
  world.obstacles = [];
  let x = 600;
  for(let i=0;i<TOTAL_OBS;i++){
    x += 240 + i*40 + Math.random()*80;
    const w = 60 + Math.round(Math.random()*28);
    const h = 48 + Math.round(Math.random()*22);
    world.obstacles.push({ worldX: Math.round(x), w, h, label: OB_LABELS[i], passed:false });
  }
  finishX = world.obstacles[world.obstacles.length-1].worldX + 420;
  arjun.worldX = finishX + 60;
}

/* -----------------------
   Camera helper
   ----------------------- */
function worldToScreen(wx){
  const cam = world.distance - player.screenX;
  return Math.round(wx - cam);
}

/* -----------------------
   Drawing
   ----------------------- */
function drawBackground(t){
  // sky
  const grad = ctx.createLinearGradient(0,0,0,CH);
  grad.addColorStop(0, '#e8f6ff'); grad.addColorStop(1, '#fff9f3');
  ctx.fillStyle = grad; ctx.fillRect(0,0,CW,CH);

  // background text "Whitefields" (smaller, moved up, less transparent)
  ctx.save();
  ctx.font = `bold ${Math.max(28, Math.floor(CW*0.06))}px Inter, Arial`;
  ctx.fillStyle = "rgba(200,200,200,0.5)";
  ctx.textAlign = "center"; ctx.textBaseline = "middle";
  ctx.shadowColor = "rgba(0,0,0,0.06)"; ctx.shadowBlur = 2;
  ctx.fillText("Whitefields", CW/2, CH/3);
  ctx.restore();

  // parallax hills
  const base = CH - 120;
  const o1 = -(world.distance*0.08) % (CW*2);
  ctx.fillStyle = "#dff3ea";
  ctx.beginPath(); ctx.moveTo(0,base);
  for(let i=0;i<6;i++){
    const cx = i*(CW/3) + o1;
    const h = 50 + 18*Math.sin(i + t*0.003);
    ctx.quadraticCurveTo(cx+80, base-h, cx + (CW/3), base);
  }
  ctx.lineTo(CW,CH); ctx.lineTo(0,CH); ctx.fill();

  // clouds
  ctx.globalAlpha = 0.95;
  const o2 = -(world.distance*0.24) % (CW+200);
  ctx.fillStyle = "#ffffff";
  for(let i=0;i<6;i++){
    const cx = ((i*180)+o2)%(CW+220) - 110;
    ctx.beginPath(); ctx.ellipse(cx, 80 + 8*Math.sin(i+t*0.006), 56, 26, 0,0,Math.PI*2); ctx.fill();
  }
  ctx.globalAlpha = 1;

  // airplane (looping)
  plane.x = (plane.x + plane.speed) % (CW + 160);
  const ax = plane.x - 80;
  const ay = 70 + 12*Math.sin(t*0.002);
  drawPlane(ax, ay);

  // ground pattern
  ctx.fillStyle = "#f8fff6"; ctx.fillRect(0, CH - 100, CW, 100);
  for(let i=0;i<Math.ceil(CW/80)+2;i++){
    const x = (i*80 - (world.distance*0.5)%80);
    ctx.fillStyle = i%2 ? "rgba(118,210,146,0.12)" : "rgba(118,210,146,0.07)";
    ctx.fillRect(x, CH-100 + (i%2?22:10), 64, 28);
  }
}
function drawPlane(x,y){
  ctx.save();
  ctx.translate(x,y);
  ctx.fillStyle = "#ffffff";
  // fuselage
  ctx.beginPath();
  ctx.roundRect(-40,-10,86,20,10);
  ctx.fill();
  // nose
  ctx.beginPath();
  ctx.moveTo(-40,-10); ctx.quadraticCurveTo(-56,0,-40,10); ctx.closePath(); ctx.fill();
  // tail
  ctx.fillStyle="#e8eefc";
  ctx.beginPath();
  ctx.moveTo(32,-10); ctx.lineTo(50,-22); ctx.lineTo(50,-10); ctx.closePath(); ctx.fill();
  // window dots
  ctx.fillStyle="#bcd3ff";
  for(let i= -20; i<=30; i+=10){ ctx.beginPath(); ctx.arc(i,0,2,0,Math.PI*2); ctx.fill(); }
  ctx.restore();
}

function drawPlayer(){
  const sx = player.screenX;
  const sy = player.y;
  // shadow
  ctx.save();
  ctx.fillStyle = "rgba(20,20,20,0.12)";
  ctx.beginPath(); ctx.ellipse(sx, CH - 120 + 8, player.size*0.95, player.size*0.5, 0,0,Math.PI*2); ctx.fill();
  ctx.restore();

  // girly gradient
  const g = ctx.createRadialGradient(sx - player.size*0.3, sy - player.size*0.4, player.size*0.2, sx, sy, player.size*1.3);
  g.addColorStop(0, "#ffcce6");
  g.addColorStop(1, "#ff99cc");
  ctx.fillStyle = g;
  ctx.beginPath(); ctx.arc(sx, sy, player.size, 0, Math.PI*2); ctx.fill();

  // eyes + eyelashes
  ctx.fillStyle = "#2b2b2b";
  // left eye
  ctx.beginPath(); ctx.arc(sx - player.size*0.28, sy - player.size*0.08, player.size*0.12, 0, Math.PI*2); ctx.fill();
  // eyelashes left
  ctx.strokeStyle = "#2b2b2b"; ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(sx - player.size*0.34, sy - player.size*0.18);
  ctx.lineTo(sx - player.size*0.44, sy - player.size*0.26); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(sx - player.size*0.22, sy - player.size*0.18);
  ctx.lineTo(sx - player.size*0.12, sy - player.size*0.26); ctx.stroke();

  // right eye
  ctx.beginPath(); ctx.arc(sx + player.size*0.06, sy - player.size*0.08, player.size*0.12, 0, Math.PI*2); ctx.fill();
  // eyelashes right
  ctx.beginPath(); ctx.moveTo(sx + 0, sy - player.size*0.18);
  ctx.lineTo(sx - player.size*0.1, sy - player.size*0.26); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(sx + player.size*0.12, sy - player.size*0.18);
  ctx.lineTo(sx + player.size*0.22, sy - player.size*0.26); ctx.stroke();

  // smile
  ctx.strokeStyle = "#b35b00"; ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(sx - player.size*0.15, sy + player.size*0.12);
  ctx.quadraticCurveTo(sx, sy + player.size*0.28, sx + player.size*0.15, sy + player.size*0.12);
  ctx.stroke();

  // blush
  ctx.fillStyle = "rgba(255,105,180,0.5)";
  ctx.beginPath(); ctx.arc(sx - player.size*0.38, sy + player.size*0.02, player.size*0.16, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(sx + player.size*0.28, sy + player.size*0.02, player.size*0.16, 0, Math.PI*2); ctx.fill();

  // bow
  ctx.fillStyle = "#ff69b4";
  ctx.beginPath(); ctx.ellipse(sx - player.size*0.5, sy - player.size*0.55, player.size*0.25, player.size*0.18, -0.4, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.ellipse(sx - player.size*0.28, sy - player.size*0.55, player.size*0.25, player.size*0.18, 0.4, 0, Math.PI*2); ctx.fill();
  ctx.fillStyle = "#d63384";
  ctx.beginPath(); ctx.arc(sx - player.size*0.38, sy - player.size*0.55, player.size*0.12, 0, Math.PI*2); ctx.fill();

  // name
  ctx.fillStyle = "rgba(0,0,0,0.85)";
  ctx.font = "700 16px Inter, Arial";
  ctx.textAlign = "center";
  ctx.fillText("Nymisha", sx, sy - player.size - 12);
}

function drawObstacle(ob){
  const sx = worldToScreen(ob.worldX);
  if(sx < -200 || sx > CW + 200) return;
  const baseY = CH - 120;
  ctx.save();
  ctx.translate(sx, baseY);
  // rounded card
  roundRect(ctx, -ob.w/2, -ob.h, ob.w, ob.h, 12);
  ctx.fillStyle = ob.label === "Life issues" ? "#ffdede"
                 : ob.label === "Kiwi issues" ? "#e6fff2"
                 : ob.label === "Body pain" ? "#fff2d9"
                 : ob.label === "Seem aunty" ? "#f0e7ff" : "#ffdce6";
  ctx.fill();

  // label (BLUE as requested)
  ctx.fillStyle = "#3A8DFF";
  ctx.font = "700 14px Inter, Arial";
  ctx.textAlign = "center";
  ctx.fillText(ob.label, 0, -ob.h - 12);

  // icon inside
  const icon = OB_ICONS[ob.label];
  if(icon){
    ctx.fillStyle = "#222";
    ctx.font = `${Math.floor(ob.h*0.6)}px serif`;
    ctx.fillText(icon, 0, -ob.h/2 + 8);
  }

  // passed overlay
  if(ob.passed){
    ctx.fillStyle = "rgba(0,0,0,0.06)";
    ctx.beginPath(); ctx.arc(0, -ob.h/2 + 2, ob.w/2 + 8, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = "#ffffff"; ctx.font = "800 20px Arial"; ctx.fillText("âœ“", 0, -ob.h/2 + 8);
  }
  ctx.restore();
}

function drawArjun(){
  const sx = worldToScreen(arjun.worldX);
  if(sx < -200 || sx > CW + 200) return;
  const base = CH - 160;

  // continuous bounce if celebrating, else gentle idle when near
  const bounce = celebrating ? Math.abs(Math.sin(arjun.bouncePhase))*22 : (arjun.jumping ? Math.abs(Math.sin(arjun.jt*0.02))*18 : 0);

  // baby head
  const gg = ctx.createLinearGradient(sx-20, base-40-bounce, sx+20, base+20-bounce);
  gg.addColorStop(0, "#fffbe8"); gg.addColorStop(1, "#ffeeb5");
  ctx.fillStyle = gg;
  ctx.beginPath(); ctx.arc(sx, base - bounce, 34, 0, Math.PI*2); ctx.fill();

  // hair tuft
  ctx.strokeStyle = "#5a3b1e"; ctx.lineWidth = 2;
  ctx.beginPath(); ctx.arc(sx, base - 44 - bounce, 8, Math.PI*0.8, Math.PI*1.4); ctx.stroke();

  // eyes (cute)
  ctx.fillStyle = "#2b2b2b";
  ctx.beginPath(); ctx.arc(sx - 10, base - 18 - bounce, 6, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(sx + 10, base - 18 - bounce, 6, 0, Math.PI*2); ctx.fill();

  // pacifier
  ctx.fillStyle = "#66a3ff";
  ctx.beginPath(); ctx.arc(sx, base - 4 - bounce, 8, 0, Math.PI*2); ctx.fill();
  ctx.strokeStyle = "#3b6cb8"; ctx.lineWidth = 2;
  ctx.beginPath(); ctx.arc(sx, base - 4 - bounce, 12, 0, Math.PI*2); ctx.stroke();

  // nameplate
  ctx.fillStyle = "rgba(255,255,255,0.95)"; roundRect(ctx, sx - 60, base + 28, 120, 36, 8); ctx.fill();
  ctx.fillStyle = "#333"; ctx.font = "700 14px Inter, Arial"; ctx.textAlign = "center"; ctx.fillText("Arjun", sx, base + 52);
}

/* -----------------------
   Helpers
   ----------------------- */
function roundRect(ctx,x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

/* -----------------------
   Collision & Passing
   ----------------------- */
function checkCollision(){
  const px = player.screenX;
  const py = player.y;
  for(const ob of world.obstacles){
    const sx = worldToScreen(ob.worldX);
    const sy = CH - 120 - ob.h/2;
    const rx = Math.max(sx - ob.w/2, Math.min(px, sx + ob.w/2));
    const ry = Math.max(sy - ob.h/2, Math.min(py, sy + ob.h/2));
    const dx = px - rx, dy = py - ry;
    if(dx*dx + dy*dy < (player.size*player.size*0.85)){
      // Determine top-of-obstacle vs player's bottom
      const playerBottom = py + player.size*0.9;
      const topOfObs = sy - ob.h/2;
      if(playerBottom < topOfObs + 6){
        if(!ob.passed){
          ob.passed = true; world.passed++; world.score += 120; sPass();
          passedEl.textContent = `${world.passed}/${TOTAL_OBS}`;
        }
      } else {
        sHit(); endGame(false);
      }
    }
  }
}

/* -----------------------
   Physics & Loop
   ----------------------- */
function reset(){
  world.speed = BASE_SPEED;
  world.distance = 0;
  world.passed = 0;
  world.score = 0;
  player.vy = 0;
  player.y = CH - 120 - player.size;
  player.grounded = true;
  arjun.jumping = false; arjun.jt = 0; arjun.bouncePhase = 0;
  plane.x = 0;
  celebrating = false;
  buildTrack();
  scoreEl.textContent = 0;
  passedEl.textContent = `0/${TOTAL_OBS}`;
  speedEl.textContent = (world.speed/BASE_SPEED).toFixed(2) + 'x';
  retryBtn.style.display = 'none';
  msgEl.style.color = '#0b6';
  msgEl.textContent = 'Press Start â†’ Space / Click / Tap to jump.';
}

function startGame(){
  if(!running){
    running = true; paused = false; lastTS = performance.now();
    startBtn.textContent = 'Pause';
    ensureAudio();
    requestAnimationFrame(loop);
  } else {
    // toggle pause only if not celebrating
    if(!celebrating){
      paused = !paused;
      startBtn.textContent = paused ? 'Resume' : 'Pause';
      if(!paused){ lastTS = performance.now(); requestAnimationFrame(loop); }
    }
  }
}

function endGame(win){
  if(win){
    // keep loop running for celebration
    celebrating = true;
    msgEl.style.color = '#0b6';
    msgEl.textContent = `ðŸŽ‰ Nymisha reached Arjun! Arjun is bouncing!`;
    sWin();
    retryBtn.style.display = 'inline-block';
    startBtn.textContent = 'Start';
  } else {
    running = false; paused = true;
    retryBtn.style.display = 'inline-block';
    startBtn.textContent = 'Start';
    msgEl.style.color = '#b00'; msgEl.textContent = `ðŸ’¥ Oops â€” Nymisha hit an issue. Click Retry to try again.`;
  }
  // high score
  if(Math.floor(world.score) > highScore){
    highScore = Math.floor(world.score);
    localStorage.setItem(HIGH_KEY, highScore);
    highEl.textContent = highScore;
    msgEl.textContent += '  ðŸš€ New High Score!';
  }
}

function loop(ts){
  if(paused){ return; }
  const dt = Math.min(40, ts - lastTS);
  lastTS = ts;

  if(!celebrating){
    // normal gameplay motion
    world.speed += SPEED_ACCEL * dt;
    world.distance += world.speed * (dt * 0.06);

    // player physics
    player.vy += GRAVITY * (dt * 0.04);
    player.y += player.vy * (dt * 0.06);
    const groundY = CH - 120 - player.size;
    if(player.y >= groundY){ player.y = groundY; player.vy = 0; player.grounded = true; } else player.grounded = false;

    // arjun starts idle bounce near finish
    if(world.distance >= finishX - 80){
      if(!arjun.jumping) { arjun.jumping = true; world.score += 300; }
    }
    if(arjun.jumping) arjun.jt += dt;

    // collisions / passing
    checkCollision();

    // score increases
    world.score += 0.08 * (dt * 0.06);
  } else {
    // celebration mode (keep animating Arjun bounce)
    arjun.bouncePhase += dt*0.02;
  }

  // draw
  ctx.clearRect(0,0,CW,CH);
  drawBackground(performance.now());

  // obstacles
  for(const ob of world.obstacles) drawObstacle(ob);

  // Arjun + Nymisha
  drawArjun();
  drawPlayer();

  // HUD
  scoreEl.textContent = Math.floor(world.score);
  speedEl.textContent = (world.speed/BASE_SPEED).toFixed(2) + 'x';

  // check win: camera reaches arjun
  if(!celebrating && world.distance >= arjun.worldX - 60){
    endGame(true);
  }

  if(running || celebrating) requestAnimationFrame(loop);
}

/* -----------------------
   Input
   ----------------------- */
function doJump(){
  if(!running || celebrating) return;
  if(player.grounded){
    player.vy = JUMP_V; player.grounded = false; sJump();
  } else {
    if(player.vy > -6){ player.vy += JUMP_V*0.35; tone(700,0.04,'square',0.07); }
  }
}
window.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); doJump(); }});
canvas.addEventListener('mousedown', ()=> doJump(), {passive:true});
canvas.addEventListener('touchstart', (e)=>{ e.preventDefault(); doJump(); }, {passive:false});

/* -----------------------
   UI bindings
   ----------------------- */
startBtn.addEventListener('click', ()=>{
  if(!running){ reset(); startGame(); } else startGame();
});
retryBtn.addEventListener('click', ()=>{ reset(); startGame(); });
muteBtn.addEventListener('click', ()=>{ soundOn = !soundOn; muteBtn.textContent = soundOn ? 'ðŸ”Š Sound: On' : 'ðŸ”‡ Sound: Off'; });

/* -----------------------
   Init
   ----------------------- */
(function init(){
  reset();
  // unlock audio on first touch for some mobiles
  document.addEventListener('touchstart', function once(){ ensureAudio(); document.removeEventListener('touchstart', once); }, {passive:true});
})();
</script>
</body>
</html>
